<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EduHub - Student Solution</title>
    <link rel="stylesheet" href="{{url_for('static', path='styles.css')}}" />
    <style>
      .score-edit-container {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .edit-icon {
        cursor: pointer;
        color: var(--primary);
        font-size: 18px;
        padding: 5px;
        border-radius: 5px;
        transition: background-color 0.3s;
      }

      .edit-icon:hover {
        background-color: var(--light);
      }

      .form-input:disabled {
        background-color: #f5f5f5;
        cursor: not-allowed;
      }

      .form-input:not(:disabled) {
        background-color: white;
        cursor: text;
      }

      .check-icon {
        cursor: pointer;
        color: green;
        font-size: 18px;
        padding: 5px;
        border-radius: 5px;
        transition: background-color 0.3s;
        display: none;
      }

      .check-icon:hover {
        background-color: var(--light);
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="header-content">
        <div class="brand">
          CodeHive
          <img
            src="{{url_for('static', path='test4.png')}}"
            alt="CodeHive"
            width="40"
            height="35"
          />
        </div>
        <a href="/" class="loginandout">Logout</a>
        <div style="width: 40px"></div>
      </div>
    </div>
    <div class="container">
      <div class="content">
        <a
          href="/professor/{{id}}/quiz/{{qid}}/submissions"
          class="btn btn-secondary back-btn"
          >‚Üê Back to Submissions</a
        >
        <h2 class="section-title" id="studentName">
          {{student.id}} - {{student.name}}
        </h2>
        <div style="margin-bottom: 30px">
          <h4
            style="color: var(--primary); margin-bottom: 10px; font-size: 18px"
          >
            {{response.quiz.title}}
          </h4>
          <div class="solution-display">
            <strong>Question :</strong> {{response.quiz.question}}<br />
            <strong>Sample Outputs :</strong> {{response.quiz.sample_sol}}<br />
          </div>
        </div>
        <div>
          <h4
            style="color: var(--primary); margin-bottom: 10px; font-size: 18px"
          >
            {{student.name}}'s Solution:
          </h4>
          <div class="solution-display" id="studentSolution">
            {{response.answer}}
          </div>
        </div>
        <form
          id="scoreForm"
          style="
            margin-top: 30px;
            padding: 20px;
            background: var(--light);
            border-radius: 10px;
          "
          method="POST"
          action="/professor/{{id}}/quiz/{{qid}}/{{student.id}}/update-score"
        >
          <h4 style="color: var(--primary); margin-bottom: 15px">
            Scores & Comments
          </h4>
          <div class="form-group">
            <label class="form-label">Score</label>
            <div class="score-edit-container">
              <input
                type="text"
                id="scoreInput"
                class="form-input"
                placeholder="e.g., 95/100"
                style="max-width: 200px"
                value="{{response.score | replace('[', '') | replace(']', '')}}"
                name="score"
                disabled
              />
              <span class="edit-icon" id="editIcon" title="Edit score">
                <img
                  src="{{url_for('static', path='edit.png')}}"
                  alt="Edit"
                  class="action-icon"
                  width="60"
                  height="60"
                />
              </span>
              <span class="check-icon" id="checkIcon" title="Checked">
                <img
                  src="{{url_for('static', path='done.png')}}"
                  alt="Done"
                  class="checkIcon"
                  width="50"
                  height="50"
                />
              </span>
            </div>
          </div>
          {% if response.mistakes %}
          <div class="form-group">
            <label class="form-label"
              >Mistakes<br />
              {{response.mistakes | replace('[', '') | replace(']', '')}}</label
            >
          </div>
          {%endif%} {% if response.comments %}
          <div class="form-group">
            <label class="form-label"
              >Comment<br />
              {{response.comments | replace('[', '') | replace(']', '')}}</label
            >
          </div>
          {%endif%} {% if response.system_log %}
          <div class="form-group">
            <label class="form-label"
              >System Log<br />
              {%for log in response.system_log %}
              <p>{{log}}</p>
              <br />
              {%endfor%}
            </label>
          </div>
          {%endif%}
        </form>
      </div>
    </div>
    <script>
      const editIcon = document.getElementById("editIcon");
      const checkIcon = document.getElementById("checkIcon");
      const scoreInput = document.getElementById("scoreInput");
      const scoreForm = document.getElementById("scoreForm");

      editIcon.addEventListener("click", function () {
        scoreInput.disabled = false;
        editIcon.style.display = "none";
        checkIcon.style.display = "inline-block";
        scoreInput.focus();
        scoreInput.select();
      });

      checkIcon.addEventListener("click", () => {
        scoreForm.submit();
      });
      
      scoreInput.addEventListener("keypress", function (e) {
        if (e.key === "Enter" && !scoreInput.disabled) {
          scoreForm.submit();
        }
      });
    </script>
  </body>
</html>
